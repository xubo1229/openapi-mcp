

# qihoo-openapi-mcp

---

### 1. 运行mcpserver

### 环境

- Go 1.21+
- An OpenAPI 3.x YAML or JSON specification file

### 启动

- 请根据系统选择主程序

| 环境     | 命令                          |
|----------|-------------------------------|
| mac      | qihoo-openapi-mcp-mac         |
| linux    | qihoo-openapi-mcp-linux       |
| windows  | qihoo-openapi-mcp-windows.exe |

- 启动命令
```sh
# Basic usage (stdio mode)
qihoo-openapi-mcp 

# With API key
API_KEY=your_api_key qihoo-openapi-mcp 

# As HTTP-streamable server
qihoo-openapi-mcp --http=:8080 

# As SSE server
qihoo-openapi-mcp --http=:8080 --http-transport=sse 
```

- 运行异常
```sh

qihoo-openapi-mcp validate 

# 全面的检查，提供详细建议
qihoo-openapi-mcp lint 

# 启动HTTP并给出验证信息
qihoo-openapi-mcp --http=:8080 validate

# 全面的检查HTTP服务
qihoo-openapi-mcp --http=:8080 lint
```

### 2.认证

### 命令或者变量(当前认证针对启动后对tool的调用传递固定认证信息，所有模式支持)

```sh

# API Key authentication
qihoo-openapi-mcp --api-key=your_api_key 
# or use environment variable
API_KEY=your_api_key qihoo-openapi-mcp 

# Bearer token / OAuth2
qihoo-openapi-mcp --bearer-token=your_token 
# or use environment variable
BEARER_TOKEN=your_token qihoo-openapi-mcp

# Basic authentication
qihoo-openapi-mcp --basic-auth=username:password 
# or use environment variable
BASIC_AUTH=username:password qihoo-openapi-mcp 

#other header
qihoo-openapi-mcp --header=key:value 
```



### 3.Header 透传

- [ ] #### 透传是指每次调用tool,的时候header可以从mcp http请求的header直接透传到tool的实际接口header中（支持http对应的sse和streamable）

​    如: 调用mcp的tools/call时候，header带的cookie可以透传到调用getTopCpuWorker对应的api接口的header中

```
{
  "method": "tools/call",
  "params": {
    "name": "getTopCpuWorker",
    "arguments": {}
  }
}
```



- [ ] #### streamable可以支持常用认证的透传

```sh
# API Key via headers
curl -H "X-API-Key: your_api_key" http://localhost:8080/mcp -d '...'
curl -H "Api-Key: your_api_key" http://localhost:8080/mcp -d '...'

# Bearer token
curl -H "Authorization: Bearer your_token" http://localhost:8080/mcp -d '...'

# Basic authentication
curl -H "Authorization: Basic base64_credentials" http://localhost:8080/mcp -d '...'
```

##### **Supported Authentication Headers:**

- `X-API-Key` or `Api-Key` - for API key authentication

- `Authorization: Bearer <token>` - for OAuth2/Bearer token authentication

- `Authorization: Basic <credentials>` - for Basic authentication

### 4.客户端连接 

- [ ] ##### **HTTP-streamable **

**Example with curl (HTTP-streamable mode):**

```sh
# Step 1: Initialize the session
curl -X POST http://localhost:8080/mcp \
  -H "Content-Type: application/json" \
  -d '{"jsonrpc":"2.0","id":1,"method":"initialize","params":{"protocolVersion":"2025-03-26"}}'

# The response will include a Mcp-Session-Id header

# Step 2: Send JSON-RPC requests
curl -X POST http://localhost:8080/mcp \
  -H "Content-Type: application/json" \
  -H "Mcp-Session-Id: <session-id>" \
  -d '{"jsonrpc":"2.0","id":2,"method":"tools/list"}'

# Step 3: Listen for notifications
curl -N http://localhost:8080/mcp \
  -H "Mcp-Session-Id: <session-id>"
```

- [ ] ##### **SSE 客户端连接 (当使用 --http-transport=sse):**

1.连接到SSE 的endpoint以建立长连接
2.接收包含会话ID的endpoint事件
3.使用会话ID向消息端点发送JSON-RPC请求
4.通过SSE流接收响应和通知

**Example with curl (SSE mode):**

```sh
# Step 1: Connect to SSE endpoint (keep connection open)
curl -N http://localhost:8080/mcp/sse

# Output: event: endpoint
#         data: /mcp/message?sessionId=<session-id>

# Step 2: Send JSON-RPC requests (in another terminal)
curl -X POST http://localhost:8080/mcp/message?sessionId=<session-id> \
  -H "Content-Type: application/json" \
  -d '{"jsonrpc":"2.0","id":1,"method":"tools/list"}'
```

- [ ] ##### Stdio

可通过mcp注册配置方式使用工具

```json
{
    "fastly": {
        "command": "qihoo-openapi-mcp",
        "args": [
            "-api-key",
            "YOUR_API_KEY"
        ]
    }
}
```



### 5.命令行参数

| Flag                     | Environment Variable | Description                                              |
| ------------------------ | -------------------- | -------------------------------------------------------- |
| `--api-key`              | `API_KEY`            | API key for authentication                               |
| `--bearer-token`         | `BEARER_TOKEN`       | Bearer token for Authorization header                    |
| `--basic-auth`           | `BASIC_AUTH`         | Basic auth credentials (user:pass)                       |
| `--base-url`             | `OPENAPI_BASE_URL`   | Override base URL for HTTP calls                         |
| `--http`                 | -                    | Serve MCP over HTTP instead of stdio                     |
| `--tag`                  | `OPENAPI_TAG`        | Only include operations with this tag                    |
| `--include-desc-regex`   | `INCLUDE_DESC_REGEX` | Only include APIs matching regex                         |
| `--exclude-desc-regex`   | `EXCLUDE_DESC_REGEX` | Exclude APIs matching regex                              |
| `--dry-run`              | -                    | Print tool schemas as JSON and exit                      |
| `--summary`              | -                    | Print operation count summary                            |
| `--doc`                  | -                    | Generate documentation file                              |
| `--doc-format`           | -                    | Documentation format (markdown or html)                  |
| `--post-hook-cmd`        | -                    | Command to post-process schema JSON                      |
| `--no-confirm-dangerous` | -                    | Disable confirmation for dangerous actions               |
| `--extended`             | -                    | Enable human-friendly output (default is agent-friendly) |
| `--function-list-file`   | -                    | Only include operations whose operationId is listed (one per line) in the given file (for filter command) |

